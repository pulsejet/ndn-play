
<ng-template #pane1>
    <div id="sidebar">
        <ng-container
            [ngTemplateOutlet]="sideBarInner"
            [ngTemplateOutletContext]="{selnode: gs.getSelectedNode(), seledge: gs.getSelectedEdge()}">
        </ng-container>
    </div>

    <ng-template #sideBarInner let-selnode="selnode" let-seledge="seledge">
        <div *ngIf="selnode">
            <h2 class="is-size-4 mb-3">On {{ selnode.label }}</h2>

            <div class="field">
                <label class="label is-small">Node Name</label>
                <input class="input is-small" type="text" placeholder="Alice"
                    [(ngModel)]="selnode.label"
                    (input)="this.gs.nodes.update({ id: selnode.id, label: selnode.label })"
                    (change)="computeNFibs()">
            </div>

            <label class="label is-small">Express Interest</label>
            <div class="field has-addons">
                <input class="input is-small" type="text"
                       placeholder="/ndn/alice/test" #expressInput
                       value="/ndn/multicast/test/$time">

                <div class="control">
                    <button class="button is-link is-light is-small"
                            (click)="selExpressInterest(expressInput.value)">
                        Send
                    </button>
                </div>
            </div>

            <div class="field">
                <button class="button is-link full-width is-light is-small full-width"
                        [disabled]="pendingClickEvent == sendPingClick"
                        (click)="pendingClickEvent = sendPingClick">
                    Ping Node
                </button>
            </div>

            <div class="field">
                <label class="label is-small">Produced Prefixes:</label>
                <textarea class="textarea full-width mb-3 is-small"
                          id="side-produced-prefixes" #prp
                          [value]="selnode.producedPrefixes.join('\n')"></textarea>
                <button class="button is-link is-light is-small full-width"
                        (click)="gs.nodes.update({ id: selnode.id, producedPrefixes: mlstrToArray(prp.value) }); computeNFibs()">
                    Set
                </button>
            </div>

            <div class="field">
                <label class="label is-small">Execute Function:</label>
                <button class="button is-success is-light is-small full-width mb-1"
                        (click)="runCode(selnode.nfw.codeEdit);">
                    Run
                </button>
            </div>

            <div>
                <label class="label is-small">Computed FIB:</label>
                <pre>{{ selnode.nfw.strsFIB().join('\n') }}</pre>
                <br/>
            </div>

            <hr/>
        </div>

        <div *ngIf="seledge">
            <h2 class="is-size-4 mb-3">
                On
                {{ $any(gs.nodes.get(seledge.from)).label }}
                &#8212;
                {{ $any(gs.nodes.get(seledge.to)).label }}
            </h2>

            <div class="field">
                <label class="label is-small">Latency (ms)</label>
                <div class="control">
                    <input class="input is-small" type="number" placeholder="10"
                           [(ngModel)]="seledge.latency"
                           (input)="gs.edges.update(seledge); computeNFibs()">
                </div>
                <p class="help is-small">Negative for default latency</p>
            </div>

            <div class="field">
                <label class="label is-small">Loss (%)</label>
                <div class="control">
                    <input class="input is-small" type="number" placeholder="0"
                           [(ngModel)]="seledge.loss"
                           (input)="gs.edges.update(seledge)">
                </div>
                <p class="help is-small">Negative for default loss</p>
            </div>

            <hr/>
        </div>

        <div>
            <h2 class="is-size-4">Global Operations</h2>
            <br/>
            <div class="field">
                <button class="button is-link full-width is-light is-small full-width"
                        (click)="computeNFibs()">Compute Routes</button>
            </div>

            <div class="field">
                <label class="label is-small">Default Latency (ms)</label>
                <div class="control">
                    <input class="input is-small" type="number" placeholder="10"
                           [(ngModel)]="this.gs.defaultLatency"
                           (change)="computeNFibs()">
                </div>
            </div>

            <div class="field">
                <label class="label is-small">Default Loss (%)</label>
                <div class="control">
                    <input class="input is-small" type="number" placeholder="0"
                           [(ngModel)]="this.gs.defaultLoss">
                </div>
            </div>

            <div class="field">
                <label class="label is-small">Content Store Size</label>
                <div class="control">
                    <input class="input is-small" type="number" placeholder="100"
                           [(ngModel)]="this.gs.contentStoreSize">
                </div>
            </div>

            <div class="field">
                <label class="label is-small">Latency Slowdown Multiplier</label>
                <div class="control">
                    <input class="input is-small" type="number" placeholder="100"
                           [(ngModel)]="this.gs.latencySlowdown">
                </div>
            </div>

            <div class="field">
                <label class="label is-small">MiniNDN Config:</label>
                <textarea class="textarea full-width mb-1 is-small" #mnConf></textarea>
                <button class="button is-danger is-light is-small full-width" (click)="loadMiniNDNConfig(gs, mnConf.value)">
                    Load
                </button>
                <button class="button is-link is-light is-small full-width mt-1">
                    Generate
                </button>
            </div>
        </div>
    </ng-template>
</ng-template>

<ng-template #pane2>
    <ng-template #mainPane>
        <div class="main-container">
            <div class="is-small tabs main-head">
                <ul>
                    <li [class.is-active]="mainTab == mainTabs.Topology"
                        (click)="mainTab = mainTabs.Topology">
                        <a>Topology</a>
                    </li>
                    <li [class.is-active]="mainTab == mainTabs.Editor"
                        *ngIf="gs.getSelectedNode()"
                        (click)="mainTab = mainTabs.Editor">
                        <a>Editor</a>
                    </li>
                </ul>
            </div>
            <div class="main-space">
                <div #networkContainer id="network" [hidden]="mainTab != mainTabs.Topology"></div>

                <div id="editor" *ngIf="mainTab == mainTabs.Editor && gs.getSelectedNode()">
                    <app-editor [(code)]="$any(gs.getSelectedNode()).nfw.codeEdit"></app-editor>
                </div>
            </div>
        </div>
    </ng-template>


    <ng-template #lowerPane>
        <div class="lower-pane main-container">
            <div class="is-small tabs main-head">
                <ul>
                    <li [class.is-active]="lowerTab == lowerTabs.Console"
                        (click)="lowerTab = lowerTabs.Console">
                        <a>Console</a>
                    </li>
                    <li [class.is-active]="lowerTab == lowerTabs.Visualizer"
                        (click)="lowerTab = lowerTabs.Visualizer">
                        <a>Packet Visualizer</a>
                    </li>
                </ul>
            </div>
            <div class="main-space">
                <div class="console"
                     [hidden]="lowerTab !== lowerTabs.Console">
                    <div *ngFor="let lm of gs.consoleLogs" [ngClass]="lm.type">
                        {{ lm.msg }} <br/>
                    </div>
                </div>

                <div class="m-2" *ngIf="lowerTab == lowerTabs.Visualizer">
                    <app-visualizer [packet]="visualizedPacket"></app-visualizer>
                </div>
            </div>
        </div>
    </ng-template>

    <div class="full-width">
        <app-pane [pane1]="mainPane" [pane2]="lowerPane" [vertical]="true" [basis]="75"></app-pane>
    </div>
</ng-template>

<app-pane [pane1]="pane1" [pane2]="pane2" [basis]="20"></app-pane>
